(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{64:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return c})),t.d(n,"metadata",(function(){return p})),t.d(n,"rightToc",(function(){return i})),t.d(n,"default",(function(){return l}));var r=t(2),a=t(6),o=(t(0),t(90)),c={title:"Planner"},p={unversionedId:"planner",id:"planner",isDocsHomePage:!1,title:"Planner",description:"Welcome to the heart of Pathom. The planner is the part of Pathom that figures which",source:"@site/docs/planner.mdx",slug:"/planner",permalink:"/docs/planner",editUrl:"https://github.com/wilkerlucio/pathom3-docs/edit/master/docs/planner.mdx",version:"current"},i=[{value:"What is a plan?",id:"what-is-a-plan",children:[{value:"The simplest plan",id:"the-simplest-plan",children:[]},{value:"Dependencies",id:"dependencies",children:[]},{value:"AND nodes",id:"and-nodes",children:[]},{value:"OR nodes",id:"or-nodes",children:[]}]}],s={rightToc:i};function l(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},s,t,{components:n,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Welcome to the heart of Pathom. The planner is the part of Pathom that figures which\nresolvers to call, in which order to fulfill the data demand."),Object(o.b)("h2",{id:"what-is-a-plan"},"What is a plan?"),Object(o.b)("p",null,"The Pathom plan is a ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/Directed_acyclic_graph"}),"DAG"),", and\nalways has a single root."),Object(o.b)("p",null,"Now we are going to a series of examples to understand how the planner does its job,\nand what it outputs."),Object(o.b)("p",null,"To understand the planner we going to walk though a series of examples"),Object(o.b)("h3",{id:"the-simplest-plan"},"The simplest plan"),Object(o.b)("p",null,"To compute the plan, Pathom requires:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(r.a)({parentName:"li"},{href:"/docs/indexes"}),"Indexes")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(r.a)({parentName:"li"},{href:"https://edn-query-language.org/eql/1.0.0/specification.html"}),"EQL AST")," of the demand")),Object(o.b)("p",null,"For our first example, it's going to be a simple request that calls a single resolver:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-clojure"}),"(ns com.wsscode.pathom3.docs.planner\n  (:require [com.wsscode.pathom3.connect.indexes :as pci]\n            [com.wsscode.pathom3.connect.operation :as pco]\n            [com.wsscode.pathom3.connect.planner :as pcp]\n            [edn-query-language.core :as eql]))\n\n; start with a simple resolver\n(pco/defresolver answer []\n  {::answer-to-everything 42})\n\n; create environment with the indexes\n(def env (pci/register answer))\n\n; generate execution DAG\n(let [ast (eql/query->ast [::answer-to-everything])]\n  (pcp/compute-run-graph\n    (assoc env\n      :edn-query-language.ast/node ast)))\n")),Object(o.b)("p",null,"Pathom represents the plan DAG using plain Clojure maps. Our previous example generate\nthis graph:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-clojure"}),"{::pcp/nodes\n {1\n  {::pco/op-name\n   com.wsscode.pathom3.docs.planner/answer\n\n   ::pcp/node-id\n   1\n\n   ::pcp/requires\n   {:com.wsscode.pathom3.docs.planner/answer-to-everything {}}\n\n   ::pcp/input\n   {}\n\n   ::pcp/source-for-attrs\n   #{:com.wsscode.pathom3.docs.planner/answer-to-everything}}}\n\n ::pcp/index-resolver->nodes\n {com.wsscode.pathom3.docs.planner/answer #{1}}\n\n ::pcp/unreachable-resolvers\n #{}\n\n ::pcp/unreachable-attrs\n #{}\n\n ::pcp/index-ast\n {:com.wsscode.pathom3.docs.planner/answer-to-everything\n  {:type         :prop\n   :dispatch-key :com.wsscode.pathom3.docs.planner/answer-to-everything\n   :key          :com.wsscode.pathom3.docs.planner/answer-to-everything}}\n\n ::pcp/root\n 1\n\n ::pcp/index-attrs\n {:com.wsscode.pathom3.docs.planner/answer-to-everything 1}}\n")),Object(o.b)("p",null,"Visually we can represent this plan as:"),Object(o.b)("p",null,"change"),Object(o.b)("p",null,"Time to break down some of the attributes here:"),Object(o.b)("h4",{id:"pcpnodes"},Object(o.b)("inlineCode",{parentName:"h4"},"::pcp/nodes")),Object(o.b)("p",null,"Contains a map with all the nodes from this graph, indexed by ",Object(o.b)("inlineCode",{parentName:"p"},"node-id"),". The ",Object(o.b)("inlineCode",{parentName:"p"},"node-id"),"\nis a monotonic incremental value, the first node gets the ID 1."),Object(o.b)("p",null,"In case you already have some data available, you can tell the planner about it so it will\ntake that in consideration when formulating the plan."),Object(o.b)("p",null,"It can also take optionally a ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/shape-descriptor"}),"Shape Descriptor")," with the available\nattributes."),Object(o.b)("h4",{id:"pcpindex-resolver-nodes"},Object(o.b)("inlineCode",{parentName:"h4"},"::pcp/index-resolver->nodes")),Object(o.b)("p",null,"Index pointing to the nodes for a given resolver."),Object(o.b)("h4",{id:"pcproot"},Object(o.b)("inlineCode",{parentName:"h4"},"::pcp/root")),Object(o.b)("p",null,"The start node of the plan."),Object(o.b)("h4",{id:"pcpindex-attrs"},Object(o.b)("inlineCode",{parentName:"h4"},"::pcp/index-attrs")),Object(o.b)("p",null,"This index knows which node is responsible for a given attribute."),Object(o.b)("h3",{id:"dependencies"},"Dependencies"),Object(o.b)("h3",{id:"and-nodes"},"AND nodes"),Object(o.b)("h3",{id:"or-nodes"},"OR nodes"))}l.isMDXComponent=!0},90:function(e,n,t){"use strict";t.d(n,"a",(function(){return d})),t.d(n,"b",(function(){return b}));var r=t(0),a=t.n(r);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function p(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=a.a.createContext({}),l=function(e){var n=a.a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):p(p({},n),e)),t},d=function(e){var n=l(e.components);return a.a.createElement(s.Provider,{value:n},e.children)},h={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},u=a.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),d=l(t),u=r,b=d["".concat(c,".").concat(u)]||d[u]||h[u]||o;return t?a.a.createElement(b,p(p({ref:n},s),{},{components:t})):a.a.createElement(b,p({ref:n},s))}));function b(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,c=new Array(o);c[0]=u;var p={};for(var i in n)hasOwnProperty.call(n,i)&&(p[i]=n[i]);p.originalType=e,p.mdxType="string"==typeof e?e:r,c[1]=p;for(var s=2;s<o;s++)c[s]=t[s];return a.a.createElement.apply(null,c)}return a.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"}}]);